<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Font Migration Report â€” Builders Capital</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0a0a0f;
            --surface: #12121a;
            --surface-2: #1a1a25;
            --border: #2a2a3a;
            --text: #e4e4ef;
            --text-muted: #8888a0;
            --accent: #6366f1;
            --sidebar-width: 280px;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        .sidebar {
            width: var(--sidebar-width);
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }
        .sidebar-header h1 {
            font-size: 1.1rem;
            font-weight: 700;
            background: linear-gradient(135deg, #818cf8, #6366f1, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .sidebar-header p { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.2rem; }
        .nav-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            list-style: none;
        }
        .nav-item {
            padding: 0.6rem 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-muted);
            transition: all 0.2s;
            margin-bottom: 2px;
            display: flex;
            justify-content: space-between;
        }
        .nav-item:hover { background: var(--surface-2); color: var(--text); }
        .nav-item.active { background: var(--accent); color: white; }
        .nav-item .badge { 
            font-size: 0.7rem; opacity: 0.7; background: rgba(0,0,0,0.2); 
            padding: 1px 6px; border-radius: 10px; 
        }
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .stats-bar {
            display: flex;
            gap: 1.5rem;
            padding: 1rem 2rem;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
        }
        .stat-item { display: flex; align-items: baseline; gap: 0.5rem; }
        .stat-item .label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
        .stat-item .value { font-size: 1.1rem; font-weight: 700; }
        .stat-item .value.green { color: #22c55e; }
        .stat-item .value.yellow { color: #eab308; }
        .content-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
        }
        .page-container { max-width: 1200px; margin: 0 auto; }
        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        .comparison-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 2rem;
            overflow: hidden;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 1.2rem;
            background: var(--surface-2);
            border-bottom: 1px solid var(--border);
        }
        .card-header h3 { font-size: 0.9rem; font-weight: 600; }
        .diff-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .diff-badge.ok { background: rgba(34,197,94,0.15); color: #22c55e; }
        .diff-badge.warning { background: rgba(234,179,8,0.15); color: #eab308; }
        .diff-badge.alert { background: rgba(239,68,68,0.15); color: #ef4444; }
        .view-tabs { display: flex; border-bottom: 1px solid var(--border); background: var(--bg); }
        .view-tab {
            flex: 1;
            padding: 0.6rem;
            text-align: center;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            border: none;
            background: none;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }
        .view-tab:hover { color: var(--text); background: var(--surface-2); }
        .view-tab.active { color: var(--accent); border-bottom-color: var(--accent); background: var(--surface-2); }
        .view-panel { display: none; padding: 1rem; background: #000; min-height: 200px; }
        .view-panel.active { display: block; }
        .view-panel img { width: 100%; border-radius: 4px; display: block; }
        .view-panel img[data-src] { opacity: 0.3; }
        .slider-container {
            position: relative;
            overflow: hidden;
            cursor: col-resize;
            user-select: none;
            background: #000;
        }
        .slider-container img {
            display: block;
            width: 100%;
            height: auto;
            user-select: none;
            pointer-events: none;
        }
        .slider-overlay {
            position: absolute;
            top: 0; left: 0;
            height: 100%;
            width: 50%;
            overflow: hidden;
            border-right: 2px solid var(--accent);
        }
        .slider-overlay img {
            position: absolute;
            top: 0;
            left: 0;
            height: auto;
            width: 100%;
            max-width: none;
        }
        .slider-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 32px;
            height: 32px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            z-index: 10;
        }
        .slider-handle svg { width: 16px; height: 16px; fill: white; }
        .slider-label {
            position: absolute; bottom: 10px;
            padding: 4px 8px; border-radius: 4px;
            font-size: 0.65rem; font-weight: 700;
            text-transform: uppercase; pointer-events: none; z-index: 5;
            color: white;
        }
        .slider-label.old { left: 10px; background: rgba(239,68,68,0.8); }
        .slider-label.new { right: 10px; background: rgba(34,197,94,0.8); }
        .side-by-side { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
        .side-label { font-size: 0.7rem; font-weight: 600; margin-bottom: 0.4rem; color: var(--text-muted); }
        .loading { text-align: center; padding: 2rem; color: var(--text-muted); }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h1>Font Migration</h1>
            <p>Builders Capital Audit</p>
        </div>
        <ul class="nav-list" id="navList"></ul>
    </div>
    <div class="main">
        <div class="stats-bar" id="statsBar"></div>
        <div class="content-scroll" id="contentScroll">
            <div class="page-container" id="pageContainer"></div>
        </div>
    </div>
    <script>
        let appData = null;
        let currentPage = null;
        const loadedImages = new Set();

        // Lazy load images
        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src && !loadedImages.has(img.dataset.src)) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        loadedImages.add(img.src);
                        img.style.opacity = '1';
                    }
                }
            });
        }, { rootMargin: '50px' });

        // Load data
        fetch('data.json')
            .then(r => r.json())
            .then(data => {
                appData = data;
                initApp();
            })
            .catch(err => {
                document.getElementById('pageContainer').innerHTML = 
                    '<div class="loading">Error loading data: ' + err.message + '</div>';
            });

        function initApp() {
            renderStats();
            renderNav();
            showPage(appData.pages[0].name);
        }

        function renderStats() {
            const { totalPages, sectionsWithChanges, sectionsIdentical } = appData.stats;
            document.getElementById('statsBar').innerHTML = `
                <div class="stat-item"><span class="label">Pages</span><span class="value">${totalPages}</span></div>
                <div class="stat-item"><span class="label">Diffs</span><span class="value ${sectionsWithChanges > 0 ? 'yellow' : 'green'}">${sectionsWithChanges}</span></div>
                <div class="stat-item"><span class="label">Identical</span><span class="value">${sectionsIdentical}</span></div>
            `;
        }

        function renderNav() {
            const html = appData.pages.map((p, i) => `
                <li class="nav-item ${i === 0 ? 'active' : ''}" data-page="${p.name}">
                    <span>${p.name}</span>
                    ${p.sections.some(s => s.diffPercent > 0) ? '<span class="badge">!</span>' : ''}
                </li>
            `).join('');
            document.getElementById('navList').innerHTML = html;

            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    showPage(this.dataset.page);
                    document.querySelectorAll('.nav-item').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        function showPage(pageName) {
            const pageData = appData.pages.find(p => p.name === pageName);
            if (!pageData || currentPage === pageName) return;
            currentPage = pageName;

            let html = `<div class="page-title">${pageData.name}</div>`;

            if (pageData.fullPage) {
                html += renderCard('Full Page Scan', pageData.fullPage);
            }

            pageData.sections.forEach(sec => {
                html += renderCard(sec.name, sec);
            });

            document.getElementById('pageContainer').innerHTML = html;
            
            // Observe all images for lazy loading
            document.querySelectorAll('img[data-src]').forEach(img => imageObserver.observe(img));
            
            // Load first visible images immediately
            loadVisibleImages();
        }

        function renderCard(title, data) {
            const badgeClass = data.diffPercent < 1 ? 'ok' : data.diffPercent < 5 ? 'warning' : 'alert';
            return `
                <div class="comparison-card">
                    <div class="card-header">
                        <h3>${title}</h3>
                        <span class="diff-badge ${badgeClass}">${data.diffPercent}% diff</span>
                    </div>
                    <div class="view-tabs">
                        <button class="view-tab active" onclick="showView(this, 'slider')">Slider</button>
                        <button class="view-tab" onclick="showView(this, 'sidebyside')">Side by Side</button>
                        <button class="view-tab" onclick="showView(this, 'diff')">Pixel Diff</button>
                    </div>
                    <div class="view-panel active" data-view="slider">
                        <div class="slider-container">
                            <span class="slider-label old">Old</span>
                            <span class="slider-label new">New</span>
                            <img data-src="${data.new}" alt="New">
                            <div class="slider-overlay" style="width: 50%;">
                                <img data-src="${data.old}" alt="Old">
                            </div>
                            <div class="slider-handle" style="left: 50%;">
                                <svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41zM15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z" transform="scale(-1,1) translate(-24,0)"/><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
                            </div>
                        </div>
                    </div>
                    <div class="view-panel" data-view="sidebyside">
                        <div class="side-by-side">
                            <div><div class="side-label">OLD</div><img data-src="${data.old}"></div>
                            <div><div class="side-label">NEW</div><img data-src="${data.new}"></div>
                        </div>
                    </div>
                    <div class="view-panel" data-view="diff">
                        <img data-src="${data.diff}">
                    </div>
                </div>
            `;
        }

        function showView(btn, viewName) {
            const card = btn.closest('.comparison-card');
            card.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active'));
            card.querySelectorAll('.view-panel').forEach(p => p.classList.remove('active'));
            btn.classList.add('active');
            const panel = card.querySelector('[data-view="' + viewName + '"]');
            panel.classList.add('active');
            
            // Load images in newly visible panel
            panel.querySelectorAll('img[data-src]').forEach(img => {
                if (!loadedImages.has(img.dataset.src)) {
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                    loadedImages.add(img.src);
                    img.style.opacity = '1';
                    
                    // Fix slider overlay width when image loads
                    img.onload = function() {
                        fixSliderOverlay(img);
                    };
                }
            });
            
            // Fix any already loaded slider images
            panel.querySelectorAll('.slider-container').forEach(container => {
                const img = container.querySelector('img:not([data-src])');
                if (img && img.complete) {
                    fixSliderOverlay(img);
                }
            });
        }

        function loadVisibleImages() {
            const activePanel = document.querySelector('.view-panel.active');
            if (activePanel) {
                activePanel.querySelectorAll('img[data-src]').forEach(img => {
                    if (!loadedImages.has(img.dataset.src)) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        loadedImages.add(img.src);
                        img.style.opacity = '1';
                        
                        // Fix slider overlay width when image loads
                        img.onload = function() {
                            fixSliderOverlay(img);
                        };
                    }
                });
            }
        }

        function fixSliderOverlay(img) {
            const container = img.closest('.slider-container');
            if (!container) return;
            
            const overlay = container.querySelector('.slider-overlay');
            const overlayImg = overlay?.querySelector('img');
            const baseImg = container.querySelector('img:not(.slider-overlay img)');
            
            if (overlayImg && baseImg && container.offsetWidth > 0) {
                // Make overlay image same width as container to match base image
                overlayImg.style.width = container.offsetWidth + 'px';
                overlayImg.style.height = 'auto';
            }
        }

        // Slider logic
        let activeSlider = null;
        function updateSlider(e) {
            if (!activeSlider) return;
            const rect = activeSlider.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            let x = ((clientX - rect.left) / rect.width) * 100;
            x = Math.max(0, Math.min(100, x));
            activeSlider.querySelector('.slider-overlay').style.width = x + '%';
            activeSlider.querySelector('.slider-handle').style.left = x + '%';
        }

        document.addEventListener('mousedown', (e) => {
            if (e.target.closest('.slider-container')) {
                activeSlider = e.target.closest('.slider-container');
                updateSlider(e);
            }
        });
        document.addEventListener('mousemove', updateSlider);
        document.addEventListener('mouseup', () => activeSlider = null);
        document.addEventListener('touchstart', (e) => {
            if (e.target.closest('.slider-container')) {
                activeSlider = e.target.closest('.slider-container');
                updateSlider(e);
            }
        });
        document.addEventListener('touchmove', updateSlider);
        document.addEventListener('touchend', () => activeSlider = null);
    </script>
</body>
</html>